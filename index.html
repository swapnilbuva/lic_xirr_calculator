<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>LIC XIRR Calculator</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">

<div class="w-full max-w-3xl bg-white rounded-2xl shadow-xl p-8 animate-fadeIn">

    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">
        LIC Policy XIRR Calculator
    </h1>

    <!-- FORM GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div>
            <label class="font-semibold">Policy Name</label>
            <input id="pname" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300" placeholder="e.g., Jeevan Anand">
        </div>

        <div>
            <label class="font-semibold">Commencement Date</label>
            <input id="cdate" type="date" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300">
        </div>

        <div>
            <label class="font-semibold">Premium Amount</label>
            <input id="premium" type="number" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300">
        </div>

        <div>
            <label class="font-semibold">Premiums Paid</label>
            <input id="count" type="number" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300">
        </div>

        <div>
            <label class="font-semibold">Policy Maturity Date</label>
            <input id="mdate" type="date" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300">
        </div>

        <div>
            <label class="font-semibold">Total Payout / Claim</label>
            <input id="claim" type="number" class="w-full p-3 rounded-lg border mt-1 focus:ring focus:ring-blue-300" value="0">
        </div>
    </div>

    <!-- Calculate Button -->
    <button onclick="calculateXIRR()"
        class="w-full mt-8 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-xl text-lg shadow-lg transition-all active:scale-95">
        Calculate XIRR
    </button>

    <!-- Result Box -->
    <div id="resultBox" class="hidden mt-8 p-6 rounded-xl shadow-inner bg-green-50 border border-green-300">
        <h3 class="text-xl font-bold text-green-700" id="resultTitle"></h3>
        <p class="text-green-600 font-semibold mt-2 text-lg" id="resultValue"></p>
    </div>
</div>

<!-- Smooth animation -->
<style>
@keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
.animate-fadeIn { animation: fadeIn 0.8s ease-in-out; }
</style>

<script>
// SAFER XNPV
function xnpv(rate, values, dates) {
    let t0 = dates[0];
    return values.reduce((sum, value, i) => {
        let diff = (dates[i] - t0) / (1000 * 3600 * 24);
        return sum + value / Math.pow(1 + rate, diff / 365);
    }, 0);
}

// ROBUST XIRR FUNCTION (NO Infinity, NO NaN)
function xirr(values, dates) {
    let guess = 0.1;
    let eps = 1e-8; 
    let maxIter = 100;

    for (let i = 0; i < maxIter; i++) {
        let f = xnpv(guess, values, dates);
        let f1 = (xnpv(guess + eps, values, dates) - f) / eps;

        // Prevent divide-by-zero â†’ Infinity
        if (Math.abs(f1) < 1e-12) return null;

        let newGuess = guess - f / f1;

        if (Math.abs(newGuess - guess) < eps) return newGuess;

        guess = newGuess;
    }

    return null;  // XIRR didn't converge
}
</script>

</body>
</html>
